# 관리자 기능 가이드

## 🎉 새로 추가된 기능

관리자 계정으로 로그인하면 일반 사용자 계정을 생성하고 관리할 수 있습니다!

---

## 📋 기능 목록

### 1. 사용자 생성
- 일반 사용자 계정 생성
- 아이디와 비밀번호 설정
- 중복 아이디 자동 체크

### 2. 사용자 목록 조회
- 전체 사용자 목록 표시
- 사용자별 정보:
  - 아이디
  - 권한 (관리자/일반)
  - 답글 생성 수
  - 가입일
  - 마지막 로그인

### 3. 사용 통계
- 각 사용자가 생성한 답글 개수 실시간 표시
- 사용량 모니터링

### 4. 사용자 삭제
- 일반 사용자 삭제 기능
- 관리자 계정은 삭제 불가
- 자기 자신은 삭제 불가

---

## 🚀 사용 방법

### 1단계: 관리자로 로그인

```
http://localhost:3001
아이디: admin
비밀번호: admin123
```

### 2단계: 관리자 페이지 접속

로그인 후 우측 상단에 **"관리자 페이지"** 버튼이 표시됩니다.

클릭하여 관리자 페이지로 이동:
```
http://localhost:3001/admin
```

### 3단계: 새 사용자 생성

1. **"+ 새 사용자 생성"** 버튼 클릭
2. 모달 창에서 정보 입력:
   - **아이디**: 예) user1
   - **비밀번호**: 예) password123
3. **"생성"** 버튼 클릭
4. 생성 완료 후 사용자 목록에 추가됨

### 4단계: 사용자 관리

**사용자 목록에서 확인 가능한 정보:**

| 항목 | 설명 |
|-----|------|
| 아이디 | 사용자 로그인 ID |
| 권한 | 관리자 / 일반 |
| 답글 생성 수 | 해당 사용자가 생성한 총 답글 개수 |
| 가입일 | 계정 생성 날짜 |
| 마지막 로그인 | 마지막 접속 시간 |
| 작업 | 삭제 버튼 (일반 사용자만) |

---

## 📊 API 엔드포인트

### GET /api/admin/users
사용자 목록 조회 (관리자만)

**응답 예시:**
```json
{
  "success": true,
  "users": [
    {
      "id": "uuid",
      "username": "user1",
      "is_admin": false,
      "created_at": "2025-10-29T12:00:00Z",
      "last_login": "2025-10-29T15:30:00Z",
      "reply_count": 15
    }
  ]
}
```

### POST /api/admin/users
새 사용자 생성 (관리자만)

**요청:**
```json
{
  "username": "user1",
  "password": "password123"
}
```

**응답:**
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "username": "user1",
    "is_admin": false,
    "created_at": "2025-10-29T12:00:00Z"
  },
  "message": "사용자가 생성되었습니다."
}
```

### DELETE /api/admin/users
사용자 삭제 (관리자만)

**요청:**
```json
{
  "userId": "uuid"
}
```

**응답:**
```json
{
  "success": true,
  "message": "사용자가 삭제되었습니다."
}
```

---

## 🔐 권한 시스템

### 관리자 권한
- 관리자 페이지 접근
- 사용자 생성/삭제
- 모든 사용자의 통계 조회
- 답글 생성 기능 사용

### 일반 사용자 권한
- 답글 생성 기능만 사용 가능
- 관리자 페이지 접근 불가
- 자신의 이력만 조회 가능

---

## 🧪 테스트 시나리오

### 시나리오 1: 일반 사용자 생성 및 로그인

1. **admin 계정으로 로그인**
2. **관리자 페이지** 접속
3. **새 사용자 생성**:
   - 아이디: `test_user`
   - 비밀번호: `test1234`
4. **로그아웃**
5. **test_user로 로그인**
6. 답글 생성 기능 사용
7. **admin으로 다시 로그인**
8. 관리자 페이지에서 `test_user`의 답글 생성 수 확인

### 시나리오 2: 사용 통계 확인

1. 여러 사용자 생성 (user1, user2, user3)
2. 각 사용자로 로그인하여 답글 생성
3. admin으로 관리자 페이지 접속
4. 각 사용자의 답글 생성 수 비교

### 시나리오 3: 사용자 삭제

1. admin으로 관리자 페이지 접속
2. 삭제할 사용자의 **"삭제"** 버튼 클릭
3. 확인 대화상자에서 **"확인"** 클릭
4. 사용자 목록에서 제거됨 확인

---

## 🎯 주요 특징

### 1. 실시간 통계
- 사용자가 답글을 생성할 때마다 자동으로 카운트 증가
- 관리자 페이지 새로고침으로 최신 통계 확인

### 2. 안전한 삭제
- 관리자 계정은 삭제 불가
- 자기 자신은 삭제 불가
- 삭제 전 확인 대화상자

### 3. 보안
- JWT 토큰 기반 인증
- 관리자 권한 체크
- bcrypt 비밀번호 암호화

### 4. 사용자 경험
- 직관적인 UI
- 모달을 통한 사용자 생성
- 실시간 피드백 (alert)

---

## 📱 화면 구성

### 관리자 페이지 레이아웃

```
┌─────────────────────────────────────────────┐
│  관리자 페이지          답글 생성으로 돌아가기   │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│  사용자 관리                [+ 새 사용자 생성]  │
│  전체 사용자: 5명                              │
├─────────────────────────────────────────────┤
│  아이디  │ 권한  │ 답글 수 │ 가입일  │ 작업   │
├─────────────────────────────────────────────┤
│  admin  │ 관리자 │  50개  │ 10/29  │  -    │
│  user1  │ 일반  │  15개  │ 10/29  │ 삭제  │
│  user2  │ 일반  │   8개  │ 10/29  │ 삭제  │
└─────────────────────────────────────────────┘
```

---

## 🔧 데이터베이스 구조

### users 테이블
```sql
- id: UUID (Primary Key)
- username: VARCHAR(50) (Unique)
- password_hash: VARCHAR(255)
- is_admin: BOOLEAN
- created_at: TIMESTAMPTZ
- last_login: TIMESTAMPTZ
```

### reply_history 테이블
```sql
- id: UUID (Primary Key)
- user_id: UUID (Foreign Key → users.id)
- review_content: TEXT
- generated_reply: TEXT
- sentiment: VARCHAR(20)
- created_at: TIMESTAMPTZ
```

**통계 쿼리:**
```sql
SELECT user_id, COUNT(*) as reply_count
FROM reply_history
GROUP BY user_id
```

---

## ✅ 체크리스트

### 관리자 기능
- [x] 사용자 목록 조회
- [x] 새 사용자 생성
- [x] 사용자 삭제
- [x] 답글 생성 통계
- [x] 가입일/로그인 정보 표시
- [x] 권한별 배지 표시
- [x] 관리자 페이지 링크 (admin만 표시)

### API
- [x] GET /api/admin/users (목록)
- [x] POST /api/admin/users (생성)
- [x] DELETE /api/admin/users (삭제)
- [x] JWT 인증
- [x] 관리자 권한 체크

---

## 🎉 완성!

이제 admin 계정으로 로그인하여 **관리자 페이지**에서 일반 사용자를 생성하고 관리할 수 있습니다!

**접속 URL**: http://localhost:3001/admin

---

## 다음 단계 (선택사항)

- [ ] 사용자별 상세 통계 페이지
- [ ] CSV 내보내기
- [ ] 사용자 비밀번호 재설정
- [ ] 사용자 일시정지 기능
- [ ] 사용량 제한 설정
